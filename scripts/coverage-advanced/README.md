# Coverage Advanced Tool

Advanced coverage analysis tool with branch coverage measurement for Go projects.

## Features

- Statement coverage analysis
- Branch coverage detection
- Function coverage metrics
- Multiple report formats (JSON, HTML, Text)
- Configurable coverage thresholds
- Exclusion patterns for generated code
- Package and file level breakdowns

## Installation

```bash
# Build the tool
cd scripts/coverage-advanced
go build -o coverage-advanced.exe .

# Or run directly
go run scripts/coverage-advanced/main.go <args>
```

## Usage

```bash
# Generate coverage profile first
go test -coverprofile=coverage.out ./...

# Run coverage analysis
coverage-advanced coverage.out .

# Or with go run
go run scripts/coverage-advanced/main.go coverage.out .
```

### Arguments

1. `coverage-profile`: Path to Go coverage profile (generated by `go test -coverprofile`)
2. `source-dir`: Root directory of source code (typically `.`)

## Output

The tool generates three types of reports in the `./coverage/` directory:

1. **coverage-advanced.json**: Machine-readable JSON format
2. **coverage-advanced.txt**: Human-readable text summary
3. **coverage-advanced.html**: Interactive HTML report

## Coverage Thresholds

Default thresholds (exit with error if not met):
- Statement Coverage: 95%
- Branch Coverage: 90%

## Exclusions

The following patterns are automatically excluded from coverage:
- `*.pb.go` - Protocol Buffer generated files
- `*.pb.gw.go` - gRPC gateway generated files
- `*_mock.go` - Mock files
- `*/mocks/*` - Mock directories
- `*/vendor/*` - Vendor dependencies
- `*/migrations/*` - Database migrations
- `*_test.go` - Test files

## Example Output

```
================================================================================
ADVANCED COVERAGE REPORT
================================================================================

Overall Coverage:
  Statement Coverage: 87.50% (140/160)
  Branch Coverage:    82.35% (28/34)
  Function Coverage:  90.00% (18/20)

--------------------------------------------------------------------------------
Package Breakdown:
--------------------------------------------------------------------------------

src/models
  Statement: 85.00% | Branch: 80.00% | Function: 88.00%
    âš  validation.go: 72.50%
      Uncovered lines: [45, 67, 89, 102, 145]

src/services
  Statement: 90.00% | Branch: 85.00% | Function: 92.00%
```

## Exit Codes

- `0`: Success, coverage meets thresholds
- `1`: Coverage below thresholds or execution error

## Integration with CI/CD

```yaml
# GitHub Actions example
- name: Run tests with coverage
  run: go test -coverprofile=coverage.out ./...

- name: Check coverage
  run: |
    go run scripts/coverage-advanced/main.go coverage.out .

# Or with built binary
- name: Check coverage
  run: |
    ./scripts/coverage-advanced/coverage-advanced coverage.out .
```