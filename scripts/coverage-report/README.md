# Coverage Report Tool

Generates comprehensive coverage reports showing exactly which lines are uncovered in your Go project.

## Features

- Detailed line-by-line coverage analysis
- Multiple output formats (JSON, HTML, Text, Markdown)
- Function-level coverage metrics
- Critical path identification
- Uncovered error handling detection
- Package and file-level breakdowns
- Interactive HTML reports

## Installation

```bash
# Build the tool
cd scripts/coverage-report
go build -o coverage-report.exe .

# Or run directly
go run scripts/coverage-report/main.go <args>
```

## Usage

```bash
# Generate Go coverage profile first
go test -coverprofile=coverage.out ./...

# Generate coverage reports
coverage-report <coverage-file> <source-dir> <output-dir>

# Examples
coverage-report coverage.out . reports
coverage-report test.out . coverage-reports
go run scripts/coverage-report/main.go coverage.out . reports
```

### Arguments

1. `coverage-file`: Path to Go coverage profile (generated by `go test -coverprofile`)
2. `source-dir`: Root directory of source code (typically `.`)
3. `output-dir`: Directory where reports will be generated

## Output Files

The tool generates four different report formats:

### 1. uncovered-lines.json
Machine-readable JSON format containing:
- Complete coverage metrics
- Package and file breakdowns
- Line-by-line uncovered code details
- Function coverage information
- Critical path analysis

### 2. uncovered-lines.txt
Human-readable text report with:
- Overall coverage summary
- Top files with most uncovered lines
- Critical uncovered paths
- Package-level details
- Specific uncovered line listings

### 3. uncovered-lines.html
Interactive HTML report featuring:
- Visual coverage bars
- Collapsible package sections
- Color-coded coverage levels
- Line-by-line code view
- Searchable content

### 4. uncovered-lines.md
Markdown format report for:
- Documentation integration
- Pull request comments
- Wiki pages
- GitHub/GitLab integration

## Report Contents

### Coverage Metrics
- **Overall Coverage**: Percentage of lines covered by tests
- **Package Coverage**: Coverage breakdown by package
- **File Coverage**: Individual file coverage percentages
- **Function Coverage**: Coverage per function/method

### Uncovered Line Analysis
- **Line Numbers**: Exact line numbers not covered
- **Line Content**: Actual code on uncovered lines
- **Line Type**: Classification (code, branch, error-handling)
- **Context**: Function containing the uncovered line

### Critical Paths
The tool identifies critical uncovered code:
- **Error Handling**: Uncovered error paths
- **Main Functions**: Uncovered code in main functions
- **Complete Files**: Files with 0% coverage
- **Important Logic**: Key business logic without tests

## Example Output

### Text Report
```
================================================================================
UNCOVERED LINES REPORT
================================================================================

Overall Coverage: 85.3% (1523/1786 lines)
Uncovered Lines: 263
Files Analyzed: 42
Packages: 8

--------------------------------------------------------------------------------
TOP FILES WITH UNCOVERED LINES:
--------------------------------------------------------------------------------
  src/services/import.go: 45 uncovered lines (72.5% coverage)
  src/handlers/api.go: 38 uncovered lines (68.9% coverage)
  src/models/validation.go: 31 uncovered lines (77.3% coverage)

--------------------------------------------------------------------------------
CRITICAL UNCOVERED PATHS:
--------------------------------------------------------------------------------

[HIGH] Uncovered error handling paths
  - src/services/database.go
  - src/handlers/error.go

[MEDIUM] Uncovered main function code
  - cmd/server/main.go
```

### HTML Report Preview
The HTML report provides an interactive interface with:
- **Summary Cards**: Quick overview of coverage metrics
- **Coverage Bar**: Visual representation of overall coverage
- **Package Explorer**: Collapsible sections for each package
- **Line Details**: Click to see specific uncovered lines
- **Search**: Find specific functions or files

## Exclusions

The following patterns are automatically excluded from coverage:
- `*.pb.go` - Protocol Buffer generated files
- `*.pb.gw.go` - gRPC gateway generated files
- `*_mock.go` - Mock files
- `/mocks/` - Mock directories
- `/vendor/` - Vendor dependencies
- `/migrations/` - Database migrations
- `*_test.go` - Test files

## Integration with CI/CD

### GitHub Actions
```yaml
- name: Generate coverage
  run: go test -coverprofile=coverage.out ./...

- name: Generate coverage reports
  run: |
    go run scripts/coverage-report/main.go coverage.out . reports

- name: Upload reports
  uses: actions/upload-artifact@v2
  with:
    name: coverage-reports
    path: reports/
```

### GitLab CI
```yaml
coverage:
  script:
    - go test -coverprofile=coverage.out ./...
    - go run scripts/coverage-report/main.go coverage.out . reports
  artifacts:
    paths:
      - reports/
    expire_in: 1 week
```

## Tips

1. **Regular Monitoring**: Run reports regularly to track coverage trends
2. **Focus on Critical Paths**: Prioritize covering error handling and main logic
3. **Set Coverage Goals**: Aim for specific coverage percentages
4. **Review Uncovered Lines**: Not all lines need coverage (e.g., panic statements)
5. **Use with Other Tools**: Combine with mutation testing for better quality

## Coverage Goals

Recommended coverage targets:
- **Overall**: 80% minimum, 90% target
- **Critical Packages**: 95% for core business logic
- **API Handlers**: 85% for HTTP handlers
- **Models**: 90% for data models
- **Utilities**: 75% for utility functions