# Tasks: ETC明細Goモジュール完成（軽量版）

**入力**: 設計文書 from `/specs/003-api-project-git/`
**前提条件**: plan-v2.md (必須), research-v2.md, data-model.md, contracts/

## 実行フロー (main)
```
1. plan-v2.mdを機能ディレクトリから読み込み
   → 見つからない場合: ERROR "実装計画が見つかりません"
   → 抽出: 技術スタック、ライブラリ、構造
2. オプションの設計文書を読み込み:
   → data-model.md: 既存のエンティティを確認
   → contracts/: 既存の契約を確認
   → research-v2.md: 実装スコープを確認
3. カテゴリー別にタスクを生成:
   → セットアップ: 最小限の確認
   → テスト: ParseCSVHandlerのテストのみ
   → コア: ParseCSVHandler実装
   → 統合: 既存機能との連携確認
   → 仕上げ: ドキュメント更新
4. タスクルールを適用:
   → 異なるファイル = 並列実行用[P]マーク
   → 同じファイル = シーケンシャル（[P]なし）
   → 実装前にテスト（TDD）
5. タスクを順番に番号付け（T001, T002...）
6. 依存関係グラフを生成
7. 並列実行例を作成
8. タスクの完全性を検証
9. 返却: SUCCESS（タスク実行準備完了）
```

## フォーマット: `[ID] [P?] 説明`
- **[P]**: 並列実行可能（異なるファイル、依存関係なし）
- 説明に正確なファイルパスを含める

## パス規約
- **Goモジュール**: リポジトリルートにファイル配置
- テストファイルは tests/ ディレクトリに配置

## フェーズ3.1: セットアップ
- [ ] T001 プロジェクト構造の確認とテストディレクトリ作成
- [ ] T002 [P] SQLiteデータベースのWALモード設定確認

## フェーズ3.2: テスト優先（TDD） ⚠️ フェーズ3.3より先に完了必須
**重要: これらのテストは実装前に必ず作成し、必ず失敗することを確認**

- [ ] T003 ParseCSVHandlerテスト作成 in tests/integration/parse_csv_test.go
- [ ] T004 [P] CSVアップロード統合テスト作成 in tests/integration/upload_flow_test.go

## フェーズ3.3: コア実装（テストが失敗している後のみ）

### ParseCSVHandler実装
- [ ] T005 ParseCSVHandler実装 in api_handlers.go
  - multipart/form-data処理
  - 一時ファイル管理
  - 既存のParseETCCSV関数呼び出し
  - エラーハンドリング

## フェーズ3.4: 統合
- [ ] T006 既存のルーティングにParseCSVHandlerを統合確認
- [ ] T007 エラーレスポンスの一貫性確認

## フェーズ3.5: 仕上げ
- [ ] T008 [P] APIドキュメント更新 in README.md
- [ ] T009 [P] バージョン番号更新 in version.go (v0.0.17)
- [ ] T010 手動テスト実行とクイックスタートガイド検証

## 依存関係
- セットアップ（T001-T002）は全タスクの前に完了
- テスト（T003-T004）は実装（T005）より先に完了
- T005は T006, T007より先に完了
- 統合（T006-T007）は仕上げ（T008-T010）より先に完了

## 並列実行例
```bash
# セットアップとテスト準備を並列実行（T002, T004）:
Task: "SQLiteデータベースのWALモード設定確認"
Task: "CSVアップロード統合テスト作成 in tests/integration/upload_flow_test.go"

# 仕上げタスクを並列実行（T008-T009）:
Task: "APIドキュメント更新 in README.md"
Task: "バージョン番号更新 in version.go (v0.0.17)"
```

## 注記
- [P] タスク = 異なるファイル、依存関係なし
- 実装前にテストが失敗することを確認
- 各タスク後にコミット
- スコープ外: Excel/PDF出力、統計生成機能

## タスク生成ルール
*main()実行時に適用済み*

1. **スコープ削減**:
   - ParseCSVHandlerのみ実装
   - Excel/PDF/統計機能は除外

2. **既存活用**:
   - data-model.md: 変更なし
   - contracts/: 変更なし
   - ParseETCCSV関数を再利用

3. **最小限のテスト**:
   - ParseCSVHandlerのテストのみ
   - 既存機能のテストは範囲外

4. **順序付け**:
   - セットアップ → テスト → 実装 → 統合 → 仕上げ
   - TDD原則を維持

## 検証チェックリスト
*ゲート: main()が返す前にチェック*

- [x] ParseCSVHandlerのテストがある
- [x] テストが実装より前にある
- [x] 並列タスクは真に独立している
- [x] 各タスクが正確なファイルパスを指定している
- [x] スコープ外の機能が含まれていない

---

**総タスク数**: 10
**並列実行可能タスク**: 4
**推定完了時間**: 4-6時間（開発者1名の場合）
**次期バージョン**: v0.0.17